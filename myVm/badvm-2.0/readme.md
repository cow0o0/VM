# badVm-2.0

这版较1.0版本肯定会有十分巨大的改动。

一个虚拟机的设计主要考虑三块内容：

1. 指令系统
2. 编译器
3. 解释器

之前写的第一个版本主要是借鉴的x86指令集的设计方法。
第二版我觉得有必要了解一下mips指令集的设计方法。

## 指令系统

## 概述

这是基于堆栈的虚拟机

那什么是基于寄存器的虚拟机呢？？？？

表达式：

```
　　Add eax,ecx
　　可以翻译为：
　　Push ecx
　　Push eax
　　Add
　　Pop eax
```

设计原则，首先将mips指令进行了分解，得到第二层指令，在此基础上将指令进一步的分解，得到第三层指令。第三层指令是原子指令，所有的寄存器，内存，立即数都通过stack的push，pop的方式进行传递。所有的计算在虚拟机的stack上进行，这是最后的原子指令的设计原则。设计一个stack，用来计算，stack中不做任何的存储，仅用做存储临时变量。而后根据此指令系统设计相应的编译器，采用二层和三层指令随机结合的方式，也就是说实现同样功能的指令可以有多种组合形式。

```
AtomAdd
AtomMul
AtomAnd
Atom...
```
>具体参考`指令系统.md`

## 编译器

这里的编译器指的是将mips指令转换为可读结构的工具，通常需要使用到反汇编引擎，自己实现一个反汇编引擎明显是不太现实的一件事情

利用python的cstpyon。。。模块

针对核心代码进行反汇编。得到可读的结构，然后根据目标指令和自定义指令的一一对应的关系，进行映射

开始准备编写编译器。

>具体参考`编译器.md`

## 解释器

这里的解释器指的是翻译并执行虚拟机指令的功能模块。

解释器和指令系统结合的比较紧密，这是指令系统的具体编程实现

主要是大小的问题，内存分配，各个结构的大小

>具体参考`解释器.md`
